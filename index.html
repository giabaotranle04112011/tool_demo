<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸ² AI Probability Analyzer â€“ VIP Edition (CÃ³ giá»ng nÃ³i AI + Biá»ƒu Ä‘á»“)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --bg: #0b0f1a;
    --card: #131a2f;
    --accent: #1e293b;
    --text: #e2e8f0;
    --text-muted: #94a3b8;
    --green: #22c55e;
    --red: #ef4444;
    --orange: #f59e0b;
    --purple: #a78bfa;
    --blue: #3b82f6;
    --yellow: #facc15;
  }

  body {
    font-family: system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 16px;
    min-height: 100vh;
    background: linear-gradient(135deg, #0b0f1a 0%, #1e1b4b 100%);
  }

  h1 {
    font-size: 22px;
    text-align: center;
    margin-bottom: 24px;
    font-weight: 700;
    background: linear-gradient(90deg, #a78bfa, #60a5fa, #22c55e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    border: 1px solid #2a3448;
    transition: transform 0.2s;
    position: relative;
  }

  .card:hover {
    transform: translateY(-2px);
  }

  .row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
  }

  .btn {
    padding: 12px 18px;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.2s;
    flex: 1;
    min-width: 120px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    position: relative;
    overflow: hidden;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
  }

  .btn:active {
    transform: translateY(0);
  }

  .dark { background: var(--accent); color: var(--text); }
  .red { background: var(--red); color: #fff; }
  .green { background: var(--green); color: #fff; }
  .orange { background: var(--orange); color: #fff; }
  .purple { background: var(--purple); color: #fff; }
  .blue { background: var(--blue); color: #fff; }
  .yellow { background: var(--yellow); color: #000; }
  .reset { background: #475569; color: #fff; }
  .speak { background: linear-gradient(45deg, #22c55e, #16a34a); color: #fff; animation: pulse 2s infinite; }
  .undo { background: #ef4444; color: #fff; }

  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
    50% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
  }

  input, #quick3 {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: none;
    margin-top: 8px;
    font-size: 16px;
    background: var(--accent);
    color: var(--text);
    box-sizing: border-box;
  }

  input::placeholder, #quick3::placeholder {
    color: var(--text-muted);
  }

  small {
    color: var(--text-muted);
    font-size: 14px;
    display: block;
    margin-top: 8px;
  }

  .guide {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid #3b82f6;
    padding: 16px;
    border-radius: 12px;
    margin-top: 12px;
    font-size: 14.5px;
    line-height: 1.8;
    display: none;
  }

  #hist {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 16px;
    max-height: 200px;
    overflow-y: auto;
    padding: 8px;
    background: rgba(30, 41, 59, 0.3);
    border-radius: 12px;
  }

  #hist span {
    display: inline-block;
    background: var(--accent);
    border-radius: 12px;
    padding: 10px 16px;
    font-size: 15px;
    font-weight: 500;
    min-width: 120px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: all 0.2s;
  }

  #hist span:hover {
    transform: scale(1.02);
    background: #475569;
  }

  #out {
    white-space: pre-wrap;
    line-height: 1.8;
    font-size: 16px;
    min-height: 120px;
    background: var(--accent);
    padding: 16px;
    border-radius: 12px;
    margin-top: 12px;
    position: relative;
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }

  #out.speaking {
    border-color: var(--green);
    box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    background: rgba(34, 197, 94, 0.05);
  }

  #voiceControls {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    align-items: center;
  }

  .voice-btn {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    font-size: 14px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
    flex: 1;
  }

  .voice-stop { background: var(--red); color: #fff; }
  .voice-pause { background: var(--orange); color: #fff; }
  .voice-speed { background: var(--purple); color: #fff; padding: 8px 16px; flex: none; }

  .section-title {
    font-weight: 600;
    font-size: 17px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .status {
    padding: 8px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    margin-top: 8px;
    display: inline-block;
  }

  .status-ai { background: rgba(167, 139, 250, 0.2); color: var(--purple); border: 1px solid var(--purple); }
  .status-speaking { background: rgba(34, 197, 94, 0.2); color: var(--green); border: 1px solid var(--green); animation: pulse 1.5s infinite; }

  #chartContainer {
    margin-top: 16px;
    background: var(--accent);
    border-radius: 12px;
    padding: 12px;
    height: 300px;
  }

  #vipKey {
    margin-top: 8px;
  }

  .vip-feature {
    background: rgba(250, 204, 21, 0.1);
    border: 1px solid var(--yellow);
    padding: 8px;
    border-radius: 8px;
    margin-top: 8px;
    font-size: 14px;
    color: var(--yellow);
  }

  .hidden {
    display: none;
  }

  @media (max-width: 600px) {
    .btn, .voice-btn { min-width: 100%; }
    .row { flex-direction: column; }
    #voiceControls { flex-direction: column; }
  }
</style>
</head>
<body>

<h1>ğŸ² AI Probability Analyzer<br><small style="background:none;-webkit-text-fill-color:#94a3b8;font-size:16px">VIP Edition â€“ CÃ³ giá»ng nÃ³i AI + Biá»ƒu Ä‘á»“ + Dá»± Ä‘oÃ¡n nÃ¢ng cao ğŸ™ï¸ğŸ“ˆ</small></h1>

<div class="card">
  <div class="section-title">ğŸ”‘ API Key OpenAI (tÃ¹y chá»n)</div>
  <input id="key" placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
  <small>KhÃ´ng cÃ³ key váº«n xem Ä‘Æ°á»£c thá»‘ng kÃª cÆ¡ báº£n. CÃ³ key sáº½ cÃ³ phÃ¢n tÃ­ch AI + <b>tá»± Ä‘á»™ng Ä‘á»c to</b>.</small>
</div>

<div class="card hidden" id="vipSection">
  <div class="section-title">â­ VIP Key (Má»Ÿ khÃ³a tÃ­nh nÄƒng cao cáº¥p)</div>
  <input id="vipKey" placeholder="Nháº­p VIP key Ä‘á»ƒ má»Ÿ khÃ³a (vÃ­ dá»¥: )">
  <button class="btn yellow" onclick="unlockVIP()" style="width:100%;margin-top:8px">ğŸ”“ Má»Ÿ khÃ³a VIP</button>
  <small>VIP: Biá»ƒu Ä‘á»“ nÃ¢ng cao, dá»± Ä‘oÃ¡n Markov, lÆ°u tá»± Ä‘á»™ng, chá»n giá»ng nÃ³i...</small>
</div>

<div class="card">
  <div class="section-title">â• Nháº­p káº¿t quáº£ tá»«ng vÃ¡n</div>
  <div class="row" style="margin-top:16px">
    <button class="btn dark" onclick="add('Long báº£o xanh')">Long báº£o xanh<br><small>Tay con tháº¯ng</small></button>
    <button class="btn dark" onclick="add('Long báº£o Ä‘á»')">Long báº£o Ä‘á»<br><small>NhÃ  cÃ¡i tháº¯ng</small></button>
    <button class="btn green" onclick="add('ÄÃ´i xanh')">ÄÃ´i xanh<br><small>Tay con cÃ³ Ä‘Ã´i</small></button>
    <button class="btn red" onclick="add('ÄÃ´i Ä‘á»')">ÄÃ´i Ä‘á»<br><small>NhÃ  cÃ¡i cÃ³ Ä‘Ã´i</small></button>
    <button class="btn orange" onclick="add('HÃ²a')">HÃ²a</button>
  </div>

  <div style="margin-top:28px">
    <div class="section-title">âš¡ Nháº­p nhanh nhiá»u vÃ¡n cÃ¹ng lÃºc</div>
    <div class="row" style="align-items:flex-start">
      <input id="quick3" placeholder="VÃ­ dá»¥: Long báº£o Ä‘á», ÄÃ´i xanh, HÃ²a">
      <button class="btn purple" onclick="addQuick3()">â• ThÃªm táº¥t cáº£</button>
    </div>
    <small>CÃ¡ch nhau báº±ng dáº¥u pháº©y. CÃ³ thá»ƒ nháº­p 1, 2, 3 hay nhiá»u hÆ¡n Ä‘á»u Ä‘Æ°á»£c.</small>

    <button class="btn blue" onclick="toggleGuide()" style="width:100%;margin-top:16px">ğŸ“– Xem danh sÃ¡ch tÃªn cá»­a chuáº©n Ä‘á»ƒ copy-paste</button>
    <div id="guide" class="guide">
      <b>TÃªn cá»­a chuáº©n (copy Ä‘Ãºng nguyÃªn chá»¯ nhÃ©):</b><br><br>
      â€¢ Long báº£o xanh<br>
      â€¢ Long báº£o Ä‘á»<br>
      â€¢ ÄÃ´i xanh<br>
      â€¢ ÄÃ´i Ä‘á»<br>
      â€¢ HÃ²a<br><br>
      <b>VÃ­ dá»¥ chuá»—i nháº­p nhanh:</b><br>
      Long báº£o Ä‘á», ÄÃ´i xanh, HÃ²a<br>
      Long báº£o xanh, Long báº£o xanh, ÄÃ´i Ä‘á»<br>
      HÃ²a, ÄÃ´i Ä‘á», Long báº£o xanh, Long báº£o xanh
    </div>
  </div>

  <div id="hist"></div>
</div>

<div class="card">
  <div class="row">
    <button class="btn green speak" style="flex:2;font-size:17px" onclick="analyze()">ğŸ”® PhÃ¢n tÃ­ch AI + <b>Tá»± Ä‘á»™ng Ä‘á»c to</b> ğŸ™ï¸</button>
    <button class="btn reset" onclick="resetAll()">ğŸ—‘ï¸ Reset</button>
    <button class="btn undo" onclick="undoLast()">â†©ï¸ Undo</button>
  </div>
</div>

<div class="card">
  <div class="section-title">ğŸ“Š Káº¿t quáº£ phÃ¢n tÃ­ch <span id="status"></span></div>
  <div id="out"><small>ğŸ‘† Nháº­p káº¿t quáº£ â†’ báº¥m nÃºt xanh Ä‘á»ƒ nghe AI phÃ¢n tÃ­ch báº±ng giá»ng nÃ³i! ğŸ™ï¸</small></div>
  
  <div id="chartContainer" class="hidden">
    <canvas id="statsChart"></canvas>
  </div>
  
  <div id="voiceControls" style="display:none">
    <button class="voice-btn voice-stop" onclick="stopSpeech()">â¹ï¸ Dá»«ng</button>
    <button class="voice-btn voice-pause" onclick="toggleSpeech()">â¸ï¸ Táº¡m dá»«ng/Tiáº¿p tá»¥c</button>
    <select class="voice-btn voice-speed" id="voiceSpeed" onchange="changeSpeed()">
      <option value="0.8">ğŸŒ Cháº­m</option>
      <option value="1.0" selected>ğŸš¶ BÃ¬nh thÆ°á»ng</option>
      <option value="1.2">ğŸ† Nhanh</option>
      <option value="1.5">âš¡ SiÃªu nhanh</option>
    </select>
    <select class="voice-btn" id="voiceSelect" onchange="changeVoice()" style="background: var(--blue); color: #fff; flex: 2;">
      <!-- Voices will be populated here -->
    </select>
  </div>
  
  <div class="vip-feature hidden" id="vipMarkov">â­ VIP: Dá»± Ä‘oÃ¡n Markov chain nÃ¢ng cao...</div>
</div>

<script>
let hist = [];
let synth = window.speechSynthesis;
let currentUtterance = null;
let isPaused = false;
let currentSpeed = 1.0;
let selectedVoice = null;
let isVIP = false;
let chart = null;

// Khá»Ÿi táº¡o TTS vÃ  voices
function initTTS() {
  if ('speechSynthesis' in window) {
    synth.onvoiceschanged = populateVoices;
  }
  loadHistory(); // Táº£i lá»‹ch sá»­ tá»« localStorage
  document.getElementById('vipSection').classList.remove('hidden');
}

function populateVoices() {
  const voices = synth.getVoices();
  const voiceSelect = document.getElementById('voiceSelect');
  voiceSelect.innerHTML = '';
  
  const vietnameseVoices = voices.filter(voice => voice.lang.includes('vi'));
  vietnameseVoices.forEach(voice => {
    const option = document.createElement('option');
    option.value = voice.name;
    option.textContent = `${voice.name} (${voice.lang})`;
    voiceSelect.appendChild(option);
  });
  
  if (vietnameseVoices.length > 0) {
    selectedVoice = vietnameseVoices[0];
    voiceSelect.value = selectedVoice.name;
  }
}

function changeVoice() {
  const voices = synth.getVoices();
  selectedVoice = voices.find(voice => voice.name === document.getElementById('voiceSelect').value);
}

function speak(text, auto = true) {
  stopSpeech();
  
  if (!('speechSynthesis' in window)) return;

  currentUtterance = new SpeechSynthesisUtterance(text);
  currentUtterance.voice = selectedVoice || synth.getVoices().find(v => v.lang.includes('vi'));
  currentUtterance.lang = 'vi-VN';
  currentUtterance.rate = currentSpeed;
  currentUtterance.pitch = 1.0;
  currentUtterance.volume = 1.0;

  currentUtterance.onstart = () => {
    document.getElementById('out').classList.add('speaking');
    document.getElementById('status').textContent = 'ğŸ™ï¸ Äang Ä‘á»c to...';
    document.getElementById('status').className = 'status status-speaking';
    document.getElementById('voiceControls').style.display = 'flex';
  };

  currentUtterance.onend = () => {
    document.getElementById('out').classList.remove('speaking');
    document.getElementById('status').textContent = 'âœ… ÄÃ£ Ä‘á»c xong';
    document.getElementById('status').className = 'status status-ai';
    setTimeout(() => document.getElementById('status').textContent = '', 3000);
  };

  currentUtterance.onpause = () => document.getElementById('status').textContent = 'â¸ï¸ Táº¡m dá»«ng';
  currentUtterance.onresume = () => document.getElementById('status').textContent = 'â–¶ï¸ Tiáº¿p tá»¥c Ä‘á»c...';
  currentUtterance.onerror = (e) => {
    console.error('Speech error:', e);
    document.getElementById('status').textContent = 'âŒ Lá»—i giá»ng nÃ³i';
    document.getElementById('out').classList.remove('speaking');
  };

  synth.speak(currentUtterance);
}

function stopSpeech() {
  synth.cancel();
  document.getElementById('out').classList.remove('speaking');
  document.getElementById('voiceControls').style.display = 'none';
  document.getElementById('status').textContent = '';
  isPaused = false;
}

function toggleSpeech() {
  if (synth.speaking) {
    if (isPaused) {
      synth.resume();
      isPaused = false;
    } else {
      synth.pause();
      isPaused = true;
    }
  }
}

function changeSpeed() {
  currentSpeed = parseFloat(document.getElementById('voiceSpeed').value);
  if (currentUtterance) currentUtterance.rate = currentSpeed;
}

function add(v) {
  hist.push(v);
  saveHistory();
  render();
  speak(`${v} Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o lá»‹ch sá»­!`, false);
}

function addQuick3() {
  const input = document.getElementById("quick3");
  const vals = input.value.split(",").map(s => s.trim()).filter(s => s);
  if (vals.length === 0) {
    alert("ChÆ°a nháº­p gÃ¬ cáº£! HÃ£y nháº­p Ã­t nháº¥t 1 káº¿t quáº£.");
    return;
  }
  vals.forEach(v => hist.push(v));
  input.value = "";
  saveHistory();
  render();
  speak(`ÄÃ£ thÃªm ${vals.length} káº¿t quáº£ má»›i!`, false);
}

function undoLast() {
  if (hist.length > 0) {
    const removed = hist.pop();
    saveHistory();
    render();
    speak(`ÄÃ£ xÃ³a ${removed} khá»i lá»‹ch sá»­!`, false);
  } else {
    alert("KhÃ´ng cÃ²n gÃ¬ Ä‘á»ƒ undo!");
  }
}

function toggleGuide() {
  const g = document.getElementById("guide");
  g.style.display = g.style.display === "none" ? "block" : "none";
}

function render() {
  const h = document.getElementById("hist");
  h.innerHTML = "";
  hist.forEach((v, i) => {
    const s = document.createElement("span");
    s.textContent = (i + 1) + ". " + v;
    s.title = `VÃ¡n ${i+1}: ${v}`;
    h.appendChild(s);
  });
  if (hist.length === 0) {
    h.innerHTML = "<small style='opacity:0.6;width:100%;text-align:center'>ChÆ°a cÃ³ dá»¯ liá»‡u nÃ o...</small>";
  }
}

function resetAll() {
  if (hist.length === 0 || confirm("Báº¡n cháº¯c muá»‘n xÃ³a háº¿t dá»¯ liá»‡u?")) {
    hist = [];
    stopSpeech();
    saveHistory();
    render();
    out("ÄÃ£ reset toÃ n bá»™ dá»¯ liá»‡u. ğŸ‘Œ");
    if (chart) chart.destroy();
    document.getElementById('chartContainer').classList.add('hidden');
  }
}

function saveHistory() {
  if (isVIP) localStorage.setItem('gameHistory', JSON.stringify(hist));
}

function loadHistory() {
  if (isVIP) {
    const saved = localStorage.getItem('gameHistory');
    if (saved) {
      hist = JSON.parse(saved);
      render();
    }
  }
}

function unlockVIP() {
  const vipInput = document.getElementById('vipKey').value.trim();
  if (vipInput === 'admin123') { // Máº«u key VIP, cÃ³ thá»ƒ thay Ä‘á»•i
    isVIP = true;
    document.getElementById('vipSection').classList.add('hidden');
    document.getElementById('vipMarkov').classList.remove('hidden');
    document.getElementById('voiceSelect').parentElement.classList.remove('hidden');
    alert('VIP unlocked! TÃ­nh nÄƒng cao cáº¥p Ä‘Ã£ má»Ÿ: Biá»ƒu Ä‘á»“, lÆ°u tá»± Ä‘á»™ng, dá»± Ä‘oÃ¡n Markov, chá»n giá»ng nÃ³i.');
    loadHistory();
  } else {
    alert('VIP key sai! Thá»­ láº¡i.');
  }
}

function out(t, autoSpeak = false) {
  document.getElementById("out").textContent = t;
  if (autoSpeak) setTimeout(() => speak(t), 500);
}

function longestStreak() {
  if (hist.length === 0) return null;
  let maxStreak = 1, currentStreak = 1, maxItem = hist[0];
  for (let i = 1; i < hist.length; i++) {
    if (hist[i] === hist[i - 1]) {
      currentStreak++;
      if (currentStreak > maxStreak) {
        maxStreak = currentStreak;
        maxItem = hist[i];
      }
    } else {
      currentStreak = 1;
    }
  }
  return maxStreak > 1 ? { item: maxItem, length: maxStreak } : null;
}

function drawChart(cnt) {
  const ctx = document.getElementById('statsChart').getContext('2d');
  if (chart) chart.destroy();
  
  const labels = Object.keys(cnt);
  const data = Object.values(cnt);
  const colors = ['#22c55e', '#ef4444', '#86efac', '#f87171', '#f59e0b'];
  
  chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{
        data: data,
        backgroundColor: colors,
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: 'PhÃ¢n bá»‘ káº¿t quáº£' }
      }
    }
  });
  
  document.getElementById('chartContainer').classList.remove('hidden');
}

function markovPrediction() {
  if (hist.length < 2) return 'KhÃ´ng Ä‘á»§ dá»¯ liá»‡u cho dá»± Ä‘oÃ¡n Markov.';
  
  const transitions = {};
  const outcomes = ['Long báº£o xanh', 'Long báº£o Ä‘á»', 'ÄÃ´i xanh', 'ÄÃ´i Ä‘á»', 'HÃ²a'];
  
  outcomes.forEach(out => transitions[out] = {});
  outcomes.forEach(out => outcomes.forEach(next => transitions[out][next] = 0));
  
  for (let i = 0; i < hist.length - 1; i++) {
    transitions[hist[i]][hist[i+1]]++;
  }
  
  const last = hist[hist.length - 1];
  const probs = {};
  let total = 0;
  Object.keys(transitions[last]).forEach(next => {
    total += transitions[last][next];
  });
  
  if (total === 0) return 'KhÃ´ng cÃ³ chuyá»ƒn tiáº¿p nÃ o tá»« ' + last;
  
  Object.keys(transitions[last]).forEach(next => {
    probs[next] = (transitions[last][next] / total * 100).toFixed(1) + '%';
  });
  
  let msg = 'â­ VIP Markov Prediction (dá»±a trÃªn chuyá»ƒn tiáº¿p):\nTá»« ' + last + ', xÃ¡c suáº¥t tiáº¿p theo:\n';
  Object.entries(probs).sort((a,b) => b[1]-a[1]).forEach(([k,v]) => msg += `â€¢ ${k}: ${v}\n`);
  return msg;
}

function analyze() {
  if (hist.length === 0) {
    out("ChÆ°a cÃ³ dá»¯ liá»‡u nÃ o. HÃ£y nháº­p Ã­t nháº¥t vÃ i vÃ¡n rá»“i báº¥m phÃ¢n tÃ­ch nhÃ©! ğŸ˜Š");
    return;
  }

  stopSpeech();

  const cnt = {};
  hist.forEach(v => cnt[v] = (cnt[v] || 0) + 1);
  const total = hist.length;

  let msg = "ğŸ“Š THá»NG KÃŠ CHI TIáº¾T\n\n";
  Object.keys(cnt).sort((a,b) => cnt[b] - cnt[a]).forEach(k => {
    msg += `â€¢ ${k}: ${cnt[k]} láº§n (${(cnt[k]/total*100).toFixed(1)}%)\n`;
  });

  const recent5 = hist.slice(-5);
  if (recent5.length > 0) {
    msg += `\nğŸ“… 5 vÃ¡n gáº§n nháº¥t:\n${recent5.join(" â†’ ")}\n`;
  }

  const streak = longestStreak();
  if (streak) {
    msg += `\nğŸ”¥ Chuá»—i dÃ i nháº¥t hiá»‡n táº¡i:\n${streak.item} (${streak.length} láº§n liÃªn tiáº¿p)\n`;
  }

  const top = Object.entries(cnt).sort((a,b) => b[1]-a[1])[0][0];
  msg += `\nğŸ§  Gá»¢I Ã NHANH:\n`;
  msg += `â€¢ Cá»­a Ä‘ang hot nháº¥t: ${top}\n`;
  msg += `â€¢ Nhá»› ráº±ng: má»i trÃ² chÆ¡i Ä‘á»u ngáº«u nhiÃªn, chá»‰ chÆ¡i vui vÃ  cÃ³ trÃ¡ch nhiá»‡m!\n`;

  if (isVIP) {
    drawChart(cnt);
    msg += `\n${markovPrediction()}\n`;
  }

  document.getElementById('status').textContent = 'ğŸ¤– Äang há»i AI...';
  document.getElementById('status').className = 'status status-ai';
  out(msg, false);

  const key = document.getElementById("key").value.trim();
  if (!key) {
    msg += `\nâš ï¸ Báº¡n Ä‘ang xem thá»‘ng kÃª thuáº§n (khÃ´ng cÃ³ AI).\nNháº­p API key Ä‘á»ƒ cÃ³ phÃ¢n tÃ­ch sÃ¢u hÆ¡n + giá»ng nÃ³i AI nhÃ©! ğŸ™ï¸`;
    if (isVIP) msg += `\nVIP Ä‘Ã£ má»Ÿ, nhÆ°ng cáº§n API key cho AI Ä‘áº§y Ä‘á»§.`;
    out(msg);
    return;
  }

  fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + key
    },
    body: JSON.stringify({
      model: "gpt-4o-mini",
      temperature: 0.6,
      messages: [
        {
          role: "system",
          content: `Báº¡n lÃ  chuyÃªn gia phÃ¢n tÃ­ch trÃ² chÆ¡i bÃ i tÃ¹y chá»‰nh giá»‘ng Baccarat.
CÃ¡c cá»­a: Long báº£o xanh (Tay con tháº¯ng), Long báº£o Ä‘á» (NhÃ  cÃ¡i tháº¯ng), ÄÃ´i xanh, ÄÃ´i Ä‘á», HÃ²a.
HÃ£y phÃ¢n tÃ­ch lá»‹ch sá»­, xu hÆ°á»›ng, chuá»—i, táº§n suáº¥t má»™t cÃ¡ch logic vÃ  thÃº vá»‹.
Gá»£i Ã½ vui cho vÃ¡n tiáº¿p theo náº¿u tháº¥y cÃ³ cÆ¡ sá»Ÿ, nhÆ°ng luÃ´n nháº¥n máº¡nh chÆ¡i cÃ³ trÃ¡ch nhiá»‡m vÃ  khÃ´ng cÃ³ gÃ¬ Ä‘áº£m báº£o tháº¯ng.
Viáº¿t ngáº¯n gá»n, dá»… nghe khi Ä‘á»c to (dÆ°á»›i 200 tá»«).`
        },
        {
          role: "user",
          content: `Lá»‹ch sá»­ cÃ¡c vÃ¡n (má»›i nháº¥t á»Ÿ cuá»‘i):\n${hist.join(" â†’ ")}

PhÃ¢n tÃ­ch xu hÆ°á»›ng hiá»‡n táº¡i vÃ  gá»£i Ã½ cá»­a nÃ o Ä‘Ã¡ng cÃ¢n nháº¯c cho vÃ¡n tiáº¿p theo (náº¿u cÃ³). Nháº¯c rÃµ rá»§i ro. Giá»¯ ngáº¯n gá»n Ä‘á»ƒ dá»… nghe.`
        }
      ]
    })
  })
  .then(r => r.json())
  .then(d => {
    const ai = d.choices?.[0]?.message?.content || "AI khÃ´ng tráº£ lá»i Ä‘Æ°á»£c.";
    const fullMsg = msg + "\n\nğŸ¤– PHÃ‚N TÃCH Tá»ª AI:\n\n" + ai;
    out(fullMsg, true);
  })
  .catch(err => {
    console.error(err);
    const errorMsg = msg + "\n\nâŒ Lá»—i káº¿t ná»‘i Ä‘áº¿n OpenAI.\nKiá»ƒm tra láº¡i API key hoáº·c máº¡ng cá»§a báº¡n.";
    out(errorMsg);
  });
}

// Khá»Ÿi táº¡o
initTTS();
render();
</script>

</body>
</html>
